<!DOCTYPE html>
<html lang="en">
<head>
<title>Book Samples</title>
<style type="text/css" media="screen">
    #editor_div { 
        position: absolute;
        display: block;
        top: 64px;
        right: 0;
        bottom: 10px;
        left: 0;
    }
    #controls_div { 
        position: absolute;
        display: block;
        left: 0;
        top: 0;
        right: 0;
        height: 32px;
    }
    #editor_frame_div {
        position: absolute;
        display: block;
        border: 1px solid;
        padding: 0px; 
        width: 45%;
        top: 50px;
        bottom: 20px;
        resize: both;
        overflow: auto;
        background-color: #ddd;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;

    }
    #script_output_textarea {
        position: absolute;
        display: block;
        left:46%;
        top:50px;
        width:200px;
        height:200px;
    }
    #quantum_gates_div {
        position: absolute;
        display: block;
        left:46%;
        top:250px;
        width:400px;
        height:200px;
    }
    #quantum_state_div {
        position: absolute;
        display: block;
        left:46%;
        top:450px;
        width:400px;
        height:500px;
    }
    #btn_run {
/*
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
*/
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 32px;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: bold;
    }
    input:disabled+label {
      color: #aaa;
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
    }
</style>
</head>
<body>

<!-- <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script> -->


<!-- Editor info: https://ace.c9.io/#nav=embedding
 -->
<b>To our technical reviewers:</b> Hello! Thank you for your help.
The cosmetics and location of this page will change, but all of the book samples should be available to run
within this page. If you find issues, please let us know.

Cheers,
<i>EJ, Nic, Mercedes</i>



<div id="editor_frame_div">
    <div id="controls_div">
        <table>
            <tr>
                <td valign="bottom">
        <input type="button" id="btn_run" value="Run Program" onclick="handle_run_button();">
                <br/>
        <input id="chk_theme" type="checkbox" onchange="handle_checkboxes();">
        <label for="chk_theme">Dark theme</label>
                </td>
                <td>
        <span id="example_choice_span">
            <select id="example_choice_sel">
            </select>
        </span>
            </td>
            <td>
        <span id="language_choice_span">
            <input type="radio" id="lang_js" name="sample_language" value="javascript" onchange="example_menu_changed();"><label for="lang_js">JavaScript (QCEngine)</label><br/>
            <input type="radio" id="lang_py" name="sample_language" value="python" onchange="example_menu_changed();"><label for="lang_py">Python (QISKit)</label><br/>
            <input type="radio" id="lang_asm" name="sample_language" value="asm" onchange="example_menu_changed();"><label for="lang_asm">QASM (IBM QE)</label>
        </span>
            </td>
        </tr>
    </table>
    </div>
    <div id="editor_div">
    </div>
</div>

<div id="output_div">
<textarea id="script_output_textarea" style="resize:both;">
(program output goes here)
</textarea>

</div>

<div id="quantum_gates_div">
</div>

<div id="quantum_state_div">
</div>




<script src="./external/ace/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>    
    var editor = ace.edit("editor_div");
    editor.session.setMode("ace/mode/javascript");

var editor_div = document.getElementById('editor_div');
var editor_frame_div = document.getElementById('editor_frame_div');
var example_choice_span = document.getElementById('example_choice_span');
var language_choice_span = document.getElementById('language_choice_span');
var script_output_textarea = document.getElementById('script_output_textarea');
var current_language = 'javascript';
var button_js = document.getElementById('lang_js');
var button_py = document.getElementById('lang_py');
var button_asm = document.getElementById('lang_asm');

function handle_run_button()
{
    if (current_language != 'javascript')
    {
        var message;
        if (current_language == 'python')
            message = 'To run the Python QISKit examples, please install QISKit at https://qiskit.org and then paste the sample code into your local editor.';
        if (current_language == 'asm')
            message = 'To run the QASM examples, please visit the IBM Quantum Experience website at https://quantumexperience.ng.bluemix.net';
        panel_staff.setVisible(false);
        panel_chart.setVisible(false);
        alert(message);
    }
    else
    {
        run_script();
        show_state_vector();
    }
}

function handle_checkboxes()
{
    if (document.getElementById('chk_theme').checked)
    {
        editor.setTheme("ace/theme/monokai");
        editor_frame_div.style.backgroundColor = '#444';
        editor_frame_div.style.color = 'white';
    }
    else
    {
        editor.setTheme("");
        editor_frame_div.style.backgroundColor = '#ddd';
        editor_frame_div.style.color = 'black';
    }

}
///////////////////////////////////////////////////////////////
// This is a small workaround for the issue where the editor
// doesn't get informed about size changes
var last_editor_div_width = 0;
var last_editor_div_height = 0;
function check_for_editor_resize()
{
    var seconds_per_check_for_editor_resize = 0.5;
    var w = editor_div.offsetWidth;
    var h = editor_div.offsetHeight;
    if (w != last_editor_div_width || h != last_editor_div_height)
    {
        editor.resize();
        last_editor_div_width = w;
        last_editor_div_height = h;
    }
    window.setTimeout(check_for_editor_resize,
                      1000 * seconds_per_check_for_editor_resize);
}
window.onload = function() {
    check_for_editor_resize();
    make_sample_menu();
};

</script>



<!-- ////////////////////////////////////////////////////////////////////// -->
<script> 

function make_sample_menu()
{
    str = '';
    str += '<select id="example_choice_sel" onchange="example_menu_changed();">';
    for (i = 0; i < sample_list.length; ++i)
    {
        sample = sample_list[i];
        str += '<option value="' + sample.id + '">';
        str += sample.menu_name;
        str += '</option>';
    }
    str += '</select>';
    example_choice_span.innerHTML = str;

    try_to_get_program_from_url()
    example_menu_changed();
}

// get_url_param() is adapted from JeffreyCrofte's work here: https://www.creativejuiz.fr/blog/en/javascript-en/read-url-get-parameters-with-javascript
function get_url_param(param) {
  var vars = {};
  window.location.href.replace( location.hash, '' ).replace( 
    /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
    function( m, key, value ) { // callback
      vars[key] = value !== undefined ? value : '';
    }
  );
  if (param) {
    return vars[param] ? vars[param] : null;  
  }
  return vars;
}

function try_to_get_program_from_url()
{
  var program_id = get_url_param('p');
  if (program_id)
  {
    for (i = 0; i < sample_list.length; ++i)
    {
      sample = sample_list[i];
      if (program_id == sample.id)
      {
        menu = document.getElementById('example_choice_sel');
        menu.value = program_id;
        return true;
      }
    }
  }
  return false;
}

function example_menu_changed()
{
    if (button_js.checked)
        current_language = 'javascript';
    if (button_py.checked)
        current_language = 'python';
    if (button_asm.checked)
        current_language = 'asm';
    menu = document.getElementById('example_choice_sel');
    load_example(menu.value);

    var editor_mode = "ace/mode/" + current_language;
    if (current_language == 'asm')
        editor_mode = '';
    editor.session.setMode(editor_mode);

    if (current_language == 'javascript')
    {
        handle_run_button();
        rewind_to_beginning();
    }
    else
    {
        panel_staff.setVisible(false);
        panel_chart.setVisible(false);
    }

    clear_output();
}

function load_example(id)
{
    for (i = 0; i < sample_list.length; ++i)
    {
        sample = sample_list[i];
        if (sample.id == id)
        {
            var id_lang = setup_program_in_language(id);
            source_area = document.getElementById(id_lang);
            if (source_area != null)
            {
                editor.focus();
                editor.setValue(source_area.value);
                editor.gotoLine(0);
                setup_script_panels(sample);
            }
            return;
        }
    }
}

function setup_program_in_language(id)
{
    var src_js = document.getElementById(id + '_javascript');
    var src_py = document.getElementById(id + '_python');
    var src_asm = document.getElementById(id + '_asm');
    button_js.disabled = (src_js == null);
    button_py.disabled = (src_py == null);
    button_asm.disabled = (src_asm == null);
    var id_lang = id + '_' + current_language;
    source_area = document.getElementById(id_lang);
    if (source_area == null)
    {
        // If the language isn't supported, switch to JavaScript
        current_language = 'javascript'
        id_lang = id + '_' + current_language;
    }
    set_current_language_checkbox();
    return id_lang;
}

function set_current_language_checkbox()
{
    if (current_language == 'javascript')
        button_js.checked = true;
    if (current_language == 'python')
        button_py.checked = true;
    if (current_language == 'asm')
        button_asm.checked = true;
}

function LoadUserName() {}

function setup_script_panels(sample)
{
    if (panel_staff)
    {
        if (current_language != 'javascript')
        {
            panel_staff.setVisible(false);
            panel_chart.setVisible(false);
            return;
        }
        // panel_staff.div.parentNode.removeChild(panel_staff.div);
        // console.log('div');
        // console.log(panel_staff);
        // console.log(panel_staff.div);
        // panel_staff.div.style.scroll = 'both';
        qc_options.color_by_phase = false;
        qc_options.circle_scale = 0.5;
        qc.start();
        qc.enableAnimation();
        // qc.reset(sample.num_qubits);
        // qc.write(0);
        // qint.new(sample.num_qubits, 'reg');

        var left = 510;
        var top = 260;
        var gate_grid = 20;
        var circle_grid = 64;
        var gate_width = 100 + 20 + gate_grid * sample.num_instructions;
        var gate_height = 80 + gate_grid * sample.num_qubits;
        panel_staff.setPos(left, top);
        panel_staff.setSize(gate_width, gate_height);
        top += gate_height + 32;
        var circle_width = 20 + circle_grid * sample.num_circle_cols;
        var circle_height = 150 + circle_grid * sample.num_circle_rows;
        panel_chart.setPos(left, top);
        panel_chart.setSize(circle_width, circle_height);
        panel_staff.setVisible(true);
        panel_chart.setVisible(true);

        panel_staff.draw();
        panel_chart.draw();
    }
}

function run_script()
{
    qc_options.color_by_phase = false;
    qc_options.circle_scale = 0.5;
    qc.start();
    if (qc) {
//      qc.disableAnimation();
//      qc.enableRecording();
      qc.codeLabel('');
    }

    qc.enableAnimation();

    runQCScriptInTextArea('editor', 'script_output_textarea');

    qc.qReg.changed();
    panel_staff.draw();
    panel_chart.draw();

    qc.enableAnimation();
}

function clear_output()
{
  script_output_textarea.value = '(output prints here)\n';
}

function rewind_to_beginning()
{
  if (current_language != 'javascript')
    return;
  console.log('instructions: ' + qc.qReg.staff.insertionStart);
  qc.qReg.staff.rewind_insertion_to_start();
}

function show_state_vector()
{
  list = panel_chart.widgets;
  for (var i = 0; i < list.length; ++i)
  {
    if (list[i].stateVector)
    {
      console.log(list[i]);
      list[i].collapsed = false;
    }
    else if (list[i].blochSphere || list[i].densityMatrix || list[i].graphState || list[i].stabilizerState)
        list[i].in_use = false;
  }
}

                // list[index].in_use = true;
                // list[index].drawQInt = qint;
                // list[index].densityMatrix = false;
                // list[index].fockState = false;
                // list[index].stabilizerState = false;
                // list[index].blochSphere = false;
                // list[index].graphState = false;
                // list[index].stateVector = false;
                // list[index].collapsed = true;

</script>



















































<script>
// This list contains an entry for each sample in this pager, aling with the
// preferred display size of various elements.
// menu_name - The name which will show up in the visible menu
// id        - The name of the textarea which contains the program. Also the url key to load it directly
// num_instructions - The number of columns in the gates diaplay.
// num_circle_rows   - The number of rows in the circles display.
// num_circle_cols   - The number of columns in the circles display.
var sample_list = [
    // { menu_name: 'Ex 4.1: Teleport 1', id: 'teleport1', num_qubits: 3, num_instructions: 21, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},

    // { menu_name: 'Ex 3.1: Logic 1', id: 'logic1', num_qubits: 3, num_instructions: 17, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 3.2: Logic 2', id: 'logic2', num_qubits: 4, num_instructions: 17, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},

    // { menu_name: 'Example: Phase Estimation 2',  id: 'phase2', num_qubits: 4, num_instructions: 14, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},

    // { menu_name: 'Ex 6.1: Grover 1', id: 'grover1', num_qubits: 4, num_instructions: 12, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 6.2: Grover 2', id: 'grover2', num_qubits: 4, num_instructions: 39, num_circle_cols: 4, num_circle_rows: 4, circle_scale: 1.0, gate_scale: 1.0},

    // { menu_name: 'Ex 7.1: QFT 1',    id: 'qft1', num_qubits: 4, num_instructions: 12, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 7.2: QFT 2',    id: 'qft2', num_qubits: 4, num_instructions: 15, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 7.3: QFT 3',    id: 'qft3', num_qubits: 4, num_instructions: 13, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 7.10: QFT 10',  id: 'qft10', num_qubits: 4, num_instructions: 11, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 7.11: QFT 11',  id: 'qft11', num_qubits: 4, num_instructions: 16, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},

    // { menu_name: 'Ex 14.1: Shor 1',  id: 'shor1', num_qubits: 4, num_instructions: 14, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 14.2: Shor 2',  id: 'shor2', num_qubits: 4, num_instructions: 14, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
    // { menu_name: 'Ex 14.7: Shor 7',  id: 'shor7', num_qubits: 4, num_instructions: 14, num_circle_cols: 16, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0},
];
</script>



<!--      CH02 one qubit        -->
<!--      CH02 one qubit        -->
<!--      CH02 one qubit        -->
<!--      CH02 one qubit        -->
<script>
sample_list.push({ menu_name: 'Ex 2-1: Random bit', id: 'ex_1qubit_1randombit', num_qubits: 1, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_1qubit_1randombit_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_1qubit_1randombit

// This sample generates a single random bit.

qc.reset(1);         // allocate one qubit
qc.write(0);         // write the value zero
qc.had();            // place it into superposition of 0 and 1
var result = qc.read();  // read the result as a digital bit

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 2-2: 8 Random bits', id: 'ex_1qubit_random_qubyte', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_1qubit_random_qubyte_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_1qubit_random_qubyte

// This sample generates a single random byte,
// using eight unentangled qubits.

qc.reset(8);         // allocate some qubits
qc.write(0);         // write the value zero
qc.had();            // place them all into superposition of 0 and 1
var result = qc.read();
qc.print('result: ' + result + '\n');

</textarea>


<script>
sample_list.push({ menu_name: 'Ex 2-3: Root-of-not', id: 'ex_1qubit_rootofnot', num_qubits: 1, num_instructions: 13, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_1qubit_rootofnot_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_1qubit_rootofnot

// This sample demonstrates construction of a ROOTNOT operation
// using HAD and PHASE operations.
// It also demonstrates the built-in ROOTNOT operator to show
// that it has the same effect. Note that applying ROOTNOT twice
// is the equivalent of a single NOT operator.

qc.reset(1);
qc.write(0);
qc.codeLabel("RNOT")
qc.had();
qc.phase(90);
qc.had();
qc.codeLabel();
qc.nop()
qc.codeLabel("RNOT")
qc.had();
qc.phase(90);
qc.had();
qc.codeLabel("")

qc.nop()
qc.codeLabel("Built-in RNOT")
qc.rootnot();
qc.nop()
qc.rootnot();
qc.codeLabel()

</textarea>


<script>
sample_list.push({ menu_name: 'Ex 2-4: Quantum Spy Hunter', id: 'ex_1qubit_spy', num_qubits: 3, num_instructions: 35, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_1qubit_spy_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_1qubit_spy


qc.reset(3);
qc.discard();
a = qint.new(1, 'alice');
fiber = qint.new(1, 'fiber');
b = qint.new(1, 'bob');

function random_bit(q) {
    q.write(0);
    q.had();
    return q.read();
}

// Generate two random bits
qc.codeLabel('get two random bits');
send_basis = random_bit(a);
send_value = random_bit(a);
qc.codeLabel('');

// Prepare Alice's qubit
a.write(0);
qc.codeLabel('set value');
qc.nop();
if (send_value)
    a.not();
qc.nop();
qc.codeLabel('');
qc.nop();
qc.codeLabel('set basis');
qc.nop();
if (send_basis)
    a.had();
qc.nop();
qc.codeLabel('');

// Send the qubit!
fiber.exchange(a);

// Activate the spy
var spy_is_present = true;
if (spy_is_present) {
    var spy_basis = 1;
    qc.nop();
    qc.codeLabel('spy');
    if (spy_basis)
        fiber.had();
    stolen_data = fiber.read();
    fiber.write(0);
    if (stolen_data)
        fiber.not();
    if (spy_basis)
        fiber.had();
    qc.codeLabel('');
    qc.nop();
}

// Receive the qubit!
recv_basis = random_bit(b);
fiber.exchange(b);
qc.codeLabel('set basis');
qc.nop();
if (recv_basis)
    b.had();
qc.nop();
qc.codeLabel('');
qc.nop();
qc.codeLabel('read value');
qc.nop();
recv_val = b.read();
qc.nop();
qc.codeLabel('');
qc.nop();

// Now Alice emails Bob to tell
// him her basis and value.
// If the basis matches and the
// value does not, there's a spy!
if (send_basis == recv_basis)
    if (send_value != recv_val)
        qc.print('Caught a spy!\n');


</textarea>





<!--      CH03 multiple qubits        -->
<!--      CH03 multiple qubits        -->
<!--      CH03 multiple qubits        -->
<!--      CH03 multiple qubits        -->

<script>
sample_list.push({ menu_name: 'Ex 3-1: Separable qubits', id: 'ch_2qubit_EX_seperable', num_qubits: 3, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ch_2qubit_EX_seperable_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ch_2qubit_EX_seperable

qc.reset(3);
qc.write(0);
var qubit1 = qint.new(1, 'qubit 1');
var qubit2 = qint.new(1, 'qubit 2');
var qubit3 = qint.new(1, 'qubit 3');
qubit2.had();
qubit3.had();

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 3-2: Entangled qubits', id: 'ch_2qubit_EX1', num_qubits: 2, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ch_2qubit_EX1_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ch_2qubit_EX1

qc.reset(2);
a = qint.new(1, 'a');
b = qint.new(1, 'b');
qc.write(0);
qc.nop();

qc.codeLabel('entangle');
a.had();           // Place into superposition
b.cnot(a);         // Entangle
qc.codeLabel();

qc.nop();
a_result = a.read();  // The two bits will be random,
b_result = b.read();  // but always the same.
qc.print(a_result);
qc.print(b_result);

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 3-3: Remote-controlled randomness', id: 'ch_2qubit_remote_random', num_qubits: 2, num_instructions: 8, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ch_2qubit_remote_random_javascript" style="display:none;">
// Run this sample online:
//  http://oreilly.machinelevel.com?p=ch_2qubit_remote_random

qc.reset(2);
a = qint.new(1, 'a');
b = qint.new(1, 'b');
qc.write(0);
a.had();
// now prob of a is 50%
b.had();
b.phase(45);
b.had();
// now prob of b is 15%
b.cnot(a);
// Now, you can read *either*
// qubit and get 50% prob.
// If the result is 0, then
// the prob of the *remaining*
// qubit is 15%, else it's 85%
a_result = a.read();
b_result = b.read();
qc.print(a_result + ' ');
qc.print(b_result + '\n');

</textarea>





























<!--      CH04 teleport       -->
<!--      CH04 teleport       -->
<!--      CH04 teleport       -->
<!--      CH04 teleport       -->




<script>
sample_list.push({ menu_name: 'Ex 4-1: Basic teleportation', id: 'teleport1', num_qubits: 3, num_instructions: 24, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="teleport1_javascript" style="display:none;">
//     http://oreilly.machinelevel.com?p=teleport1

qc.reset(3);
var alice = qint.new(1, 'alice');
var ep    = qint.new(1, 'ep');
var bob   = qint.new(1, 'bob');

qc.write(0, 2|4);
qc.codeLabel('entangle');
ep.had();
bob.cnot(ep);
qc.codeLabel('');

alice.write(0);
qc.codeLabel('prep payload');
alice.had();
alice.phase(45);
alice.had();
qc.codeLabel('');
qc.nop();
qc.print('alice prob:' + alice.peekProbability(1));
qc.codeLabel('send');
ep.cnot(alice);
alice.had();
alice.read();
ep.read();
qc.codeLabel('');
qc.nop();

qc.codeLabel('receive');
var bob_is_asleep = false;
if (bob_is_asleep) {
    bob.not();
    bob.phase(180);
} else {
    bob.cnot(ep);
    bob.cz(alice);
}
qc.codeLabel('');
qc.nop();

qc.codeLabel('verify');
bob.had();
bob.phase(-45);
bob.had();
bob.read();
qc.codeLabel('');
qc.nop();
</textarea>


<textarea id="teleport1_asm" style="display:none;">
//     http://oreilly.machinelevel.com?p=teleport1

include "qelib1.inc";
qreg q[5];
creg c[5];

// Step 1: Create an entangled pair
h q[2];
cx q[2],q[4];
barrier q[0],q[1],q[2],q[3],q[4];

// Step 2: Prepare a payload
x q[0];
h q[0];
t q[0];
barrier q[0],q[1],q[2],q[3],q[4];

// Step 3: Send
h q[0];
h q[2];
cx q[2],q[0];
h q[2];
measure q[0] -> c[0];
measure q[2] -> c[2];
barrier q[3],q[4];

// Step 4: Receive
x q[4];
z q[4];
barrier q[3],q[4];

// Step 5: Verify
tdg q[4];
h q[4];
x q[4];
measure q[4] -> c[4];
</textarea>



<textarea id="teleport1_python" style="display:none;">

import qiskit
import math

def sample_teleport1():
    # Set up the program
    alice = QuantumRegister(1, name='alice')
    ep    = QuantumRegister(1, name='ep')
    bob   = QuantumRegister(1, name='bob')
    alice_c = ClassicalRegister(1, name='alicec')
    ep_c    = ClassicalRegister(1, name='epc')
    bob_c   = ClassicalRegister(1, name='bobc')
    qc = QuantumCircuit(alice, ep, bob, alice_c, ep_c, bob_c)

    # entangle
    qc.h(ep)
    qc.cx(ep, bob)
    qc.barrier()

    # prep payload
    qc.reset(alice)
    qc.h(alice)
    qc.rz(math.radians(45), alice)
    qc.h(alice)
    qc.barrier()

    # send
    qc.cx(alice, ep)
    qc.h(alice)
    qc.measure(alice, alice_c)
    qc.measure(ep, ep_c)
    qc.barrier()

    # receive
    qc.x(bob).c_if(ep_c, 1)
    qc.z(bob).c_if(alice_c, 1)

    # verify
    qc.h(bob)
    qc.rz(math.radians(-45), bob)
    qc.h(bob)
    qc.measure(bob, bob_c)

    # Run the program!
    qis = QiskitHandler(qiskit_backend='local_qasm_simulator')
    qis.execute(qc, shots=100)
    qis.display(qc)





##################################################################################
## Below is boilerplate code for activating and running QISKit in all samples.

"""
Local simulators:
    local_qasm_simulator:        Currently does not support shots=1
    local_statevector_simulator: Currently does not support measure or reset
    local_unitary_simulator:     Currently does not draw the circuit diagram
"""

import getpass, time
from qiskit import ClassicalRegister, QuantumRegister, QuantumCircuit
from qiskit import available_backends, execute, register, least_busy, load_qasm_string
from qiskit.tools.visualization import plot_histogram, circuit_drawer

class QiskitHandler:
    def __init__(self, qiskit_backend=None, use_actual_hardware=False, run_locally=True, ibm_qe_api_token=None):
        self.ibm_qe_api_token = ibm_qe_api_token
        self.use_actual_hardware = use_actual_hardware
        self.run_locally = run_locally
        self.qiskit_backend = qiskit_backend
        self.setup()

    def setup(self):
        need_token = self.use_actual_hardware or not self.run_locally
        if need_token:
            if self.ibm_qe_api_token is None:
                self.ibm_qe_api_token = getpass.getpass('Please input your token and hit enter: ')
            self.qx_config = {
                'APItoken': self.ibm_qe_api_token,
                'url':'https://quantumexperience.ng.bluemix.net/api'}
            try:
                print('registering API token...')
                register(self.qx_config['APItoken'], self.qx_config['url'])

                print('\nYou have access to great power!')
                print(available_backends({'local': False, 'simulator': False}))
            except: 
                print('Something went wrong.\nDid you enter a correct token?')
                exit()

        # If no backend is requested, find the least busy one
        if self.qiskit_backend is None:
            self.qiskit_backend = least_busy(available_backends({'simulator': (not self.use_actual_hardware), 'local': self.run_locally}))

        print('available_backends: {}'.format(available_backends()))
        print('Using simulator backend: ' + self.qiskit_backend)

    def execute(self, circuit, shots=1, max_credits=3):
        self.job_exp = execute(circuit, backend=self.qiskit_backend, shots=shots, max_credits=max_credits)
        lapse = 0
        interval = 30
        while not self.job_exp.done:
            print('Status @ {} seconds'.format(interval * lapse))
            print(self.job_exp.status)
            time.sleep(interval)
            lapse += 1
        print(self.job_exp.status)

    def display(self, circuit):
        if self.qiskit_backend != 'local_unitary_simulator':
            print('drawing circuit...')
            circuit_drawer(circuit)
            print('drawing histogram...,')
            print('   (close graph windows to proceed)')
            plot_histogram(self.job_exp.result().get_counts(circuit))


if __name__ == '__main__':
    sample_teleport1()

</textarea>

<!--
    TODO QCEngine features to add:
    Single-bit phase!!! For the receive_payload func
-->


<script>
sample_list.push({ menu_name: 'Ex 4-2: A fly in the teleporter', id: 'teleportfly', num_qubits: 24, num_instructions: 60, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="teleportfly_javascript" style="display:none;">
//    http://oreilly.machinelevel.com?p=teleportfly

///////////////////////////////////////////////////
// Fly in the Teleporter
//
// This is a fun and horrifying example from the
// teleportation chapter.

qc_options.color_by_phase = true;

// This is the left half of the pixels of the fly,
// encoded as an 8x16 array:

var image = [ '........',
              '...X....',
              '....X.XX',
              '.....XXX',
              '....XXXX',
              'XX...XXX',
              '..XXX.XX',
              '...X....',
              '..X...XX',
              '.X...XXX',
              'X....XXX',
              'X..XXXXX',
              '.XXX.XXX',
              '...X..XX',
              '..X.....',
              '........'];

// This is the classic teleport example, but with an interesting
// payload, and some controllable error.
function main()
{
    var teleport_error = 0.0   // <--- change this number to 0.1 or more
    var do_teleport = true; // Enables the teleporter

    qc.reset(24);
    var fly = qint.new(8, 'fly');
    var epair1 = qint.new(8, 'epair1');
    var epair2 = qint.new(8, 'epair2');

    prepare_fly(fly);
    if (do_teleport)
    {
        entangle_pair(epair1, epair2);
        var digital_bits = send_payload(fly, epair1);
        
        apply_error(epair2, teleport_error);
        
        receive_payload(epair2, digital_bits);
        cleanup_view(fly, epair1, epair2);
    }
}

function entangle_pair(ep1, ep2)
{
    qc.codeLabel('entangle pair');

    // Create all the entangled qubits we need to teleport this object.    
    ep1.write(0);
    ep2.write(0);
    ep1.hadamard();
    ep2.cnot(ep1);

    qc.codeLabel('');
    qc.nop();
}

var last_not = 0;

function prepare_fly(fly)
{
    qc.codeLabel('encode fly');

    // Encode the fly pixels into relative phases in a
    // quantum superposition
    fly.write(0);
    fly.hadamard();
    for (var y = 0; y < image.length; ++y)
    {
        for (var x = 0; x < image[0].length; ++x)
        {
            if (image[y][x] == 'X')
                pixel(fly, x + 0, y);
        }
    }
    fly.not(last_not);
    qc.cnot(fly.bits(0x7), fly.bits(0x8));
    fly.Grover();

    // At this point, reading the "fly" register would be very likely
    // to return the coordinates of one of the pixels in the fly.
    qc.codeLabel('');
    qc.nop();
}

function pixel(obj, x, y)
{
    // Given x and y, flip the phase of one term
    // Note: last_not is used to avoid redundant NOT gates
    var val = ~((y << 4) | x);
    obj.not(val ^ last_not);
    last_not = val;
    obj.phase(180, ~0x8);
}

function send_payload(payload, ep)
{
    qc.codeLabel('send payload');

    // Entangle the payload with half of the e-pair, and then vaporize it!
    ep.cnot(payload);
    payload.hadamard();
    var digital_bits = [payload.read(), ep.read()];

    qc.codeLabel('');
    qc.nop();
    return digital_bits;
}

function apply_error(qubits, error_severity)
{
    qc.codeLabel('apply error');

    // Apply some unpredictable noise to the system
    qc.noise(error_severity, qubits.bits());

    qc.codeLabel('');
    qc.nop();
}

function receive_payload(ep, digital_bits)
{
    qc.codeLabel('receive payload');

    // Teleport receiver applies the correct operations based on
    // the digital data. Note that in this example we *could*
    // use postselection, but would only succeed once every 65,536
    // tries, on average.
    ep.not(digital_bits[1]);
    for (var bit = 1; bit <= digital_bits[0]; bit <<= 1)
    {
        if (bit & digital_bits[0])
            ep.phase(180, bit);
    }
    qc.codeLabel('');
    qc.nop();
}

function cleanup_view(fly, epair1, epair2)
{
    // Here, we make the resulting fly show up nicely in our state vector display.
    fly.exchange(epair2);
    epair1.write(0);
    epair2.write(0);
    epair1.discard();
    epair2.discard();
    qc.nop();
    show_state_vector();
}

function show_state_vector()
{
  list = panel_chart.widgets;
  for (var i = 0; i < list.length; ++i)
  {
    if (list[i].stateVector)
    {
      console.log(list[i]);
      list[i].collapsed = false;
    }
    else if (list[i].blochSphere || list[i].densityMatrix || list[i].graphState || list[i].stabilizerState)
        list[i].in_use = false;
  }
}

main();




</textarea>











<!--      CH05 logic       -->
<!--      CH05 logic       -->
<!--      CH05 logic       -->
<!--      CH05 logic       -->

<script>
sample_list.push({ menu_name: 'Ex 5-1: Increment and decrement', id: 'logic2', num_qubits: 4, num_instructions: 18, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="logic2_javascript" style="display:none;">
// Run this sample online:
//    http://oreilly.machinelevel.com?p=logic2

// This sample demonstrates increment and decrement of
// integers in superposition.

num_qubits = 4;
qc.reset(num_qubits);
a = qint.new(num_qubits, 'a');

// prepare
qc.codeLabel('prepare')
a.write(1);
a.hadamard(0x4);
a.phase(45, 0x4);
qc.nop();

qc.codeLabel('')
qc.nop();
qc.codeLabel('increment')
// increment
a.add(1);

qc.codeLabel('')
qc.nop();
qc.codeLabel('decrement')
// decrement
a.subtract(1);

qc.codeLabel('')
qc.nop();
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 5-2: Adding two quantum integers', id: 'ex_ch_logic3', num_qubits: 8, num_instructions: 20, num_circle_cols: 8, num_circle_rows: 8, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_ch_logic3_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_ch_logic3

// Initialize
num_qubits = 6;
qc.reset(num_qubits);
a = qint.new(4, 'a');
b = qint.new(2, 'b');

// prepare
qc.codeLabel('prepare');
a.write(1);
a.hadamard(0x4);
a.phase(45, 0x4);
b.write(1);
b.hadamard(0x2);
b.phase(90, 0x2);
qc.nop();
qc.codeLabel('');
qc.nop();

// a += b
qc.codeLabel('a += b');
a.add(b);
qc.codeLabel('');
qc.nop();

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 5-3: Add-squared', id: 'ex_ch_logic_4', num_qubits: 8, num_instructions: 26, num_circle_cols: 8, num_circle_rows: 8, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_ch_logic_4_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_ch_logic_4

// Initialize
num_qubits = 6;
qc.reset(num_qubits);
a = qint.new(4, 'a');
b = qint.new(2, 'b');
// prepare
qc.codeLabel('prepare');
a.write(1);
a.hadamard(0x4);
a.phase(45, 0x4);
b.write(1);
b.hadamard(0x2);
b.phase(90, 0x2);
qc.nop();
qc.codeLabel('');
qc.nop();

qc.codeLabel('a += b');

// a += b * b
a.addSquared(b);

qc.codeLabel('');
qc.nop();


</textarea>

<script>
sample_list.push({ menu_name: 'Ex 5-4: Quantum conditional execution', id: 'ex_ch_logic5', num_qubits: 8, num_instructions: 26, num_circle_cols: 8, num_circle_rows: 8, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_ch_logic5_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_ch_logic5

// In this sample, b will be incremented, but ONLY
// for terms where a is less than 3

// Initialize
num_qubits = 6;
qc.reset(num_qubits);
a = qint.new(3, 'a');
b = qint.new(3, 'b');

// prepare
qc.codeLabel('a = (1, 5)');
a.write(1);
a.hadamard(0x4);
qc.codeLabel('');
qc.nop();
qc.codeLabel('b = (1, 3)');
b.write(1);
b.hadamard(0x2);
b.phase(45, 0x2);
qc.codeLabel('');
qc.nop();

// if a < 3 then b += 1
qc.codeLabel('a -= 3');
a.subtract(3);
qc.codeLabel('');
qc.nop();
qc.codeLabel('if (a < 0) then b++');
b.add(1, a.bits(0x4));
qc.codeLabel('');
qc.nop();
qc.codeLabel('a += 3');
a.add(3);

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 5-5: Quantum conditional phase flip', id: 'ex_ch_logic6', num_qubits: 8, num_instructions: 26, num_circle_cols: 8, num_circle_rows: 4, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_ch_logic6_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_ch_logic6

// Initialize
qc_options.color_by_phase = true;
num_qubits = 5;
qc.reset(num_qubits);
a = qint.new(3, 'a');
b = qint.new(2, 'b');
// prepare
qc.codeLabel('a = 0,1,2,3');
a.write(0);
a.hadamard(0x1|0x2);
qc.codeLabel('');
qc.nop();
qc.codeLabel('b = 1,3');
b.write(1);
b.hadamard(0x2);
qc.codeLabel('');
qc.nop();

//Flip the phase if +a+ is less than 3 and +b+ is equal to 1
qc.codeLabel('a -= 3        ');
a.subtract(3);
qc.codeLabel('');
qc.nop();
qc.codeLabel('flip if (a < 0 && b==1)');
b.not(~1);
qc.phase(180, a.bits(0x4, b.bits(~0)));
b.not(~1);
qc.codeLabel('');
qc.nop();
qc.codeLabel('        a += 3');
a.add(3);
qc.codeLabel('');

</textarea>



<!--      CH06 amplitude amplification       -->
<!--      CH06 amplitude amplification       -->
<!--      CH06 amplitude amplification       -->
<!--      CH06 amplitude amplification       -->

<script>
sample_list.push({ menu_name: 'Ex 5-1: Grover iterations', id: 'grover_ex_grover2', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="grover_ex_grover2_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=grover_ex_grover2

var number_to_flip = 3;
var number_of_iterations = 4;

var num_qubits = 4;
qc.reset(num_qubits);
var reg = qint.new(num_qubits, 'reg')
reg.write(0);
reg.hadamard();

for (var i = 0; i < number_of_iterations; ++i)
{
    // Flip the marked value
    reg.not(~number_to_flip);
    reg.phase(180);
    reg.not(~number_to_flip);

    reg.Grover();

    // Peek at the probability
    prob = reg.peekProbability(number_to_flip);
}

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 5-2: Grover frequencies', id: 'grover_ex_grover6', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="grover_ex_grover6_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=grover_ex_grover6

var n2f = [0,1,2];             // Which terms to flip
var number_of_iterations = 50; // The number of Grover iterations

var num_qubits = 4;
qc.reset(num_qubits);
var reg = qint.new(num_qubits, 'reg')
reg.write(0);
reg.hadamard();

for (var i = 0; i < number_of_iterations; ++i)
{
    // Flip the marked value
    for (var j = 0; j < n2f.length; ++j)
    {
        var marked_term = n2f[j];
        reg.not(~marked_term);
        reg.phase(180);
        reg.not(~marked_term);
    }

    reg.Grover();

    prob = 0;
    for (var j = 0; j < n2f.length; ++j)
    {
        var marked_term = n2f[j];
        prob += reg.peekProbability(marked_term);
    }
    qc.print('iters: '+i+' prob: '+prob);
}
</textarea>




<!--      CH07 QFT       -->
<!--      CH07 QFT       -->
<!--      CH07 QFT       -->
<!--      CH07 QFT       -->

<script>
sample_list.push({ menu_name: 'Ex 7-1: QFT to distinguish 3 states', id: 'qft_sample_abc', num_qubits: 4, num_instructions: 16, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qft_sample_abc_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qft_sample_abc
qc_options.color_by_phase = true;
qc_options.book_render = true;

var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')
var which_signal = 'A';

// prepare the signal
qc.codeLabel('prepare');
signal.write(0);
signal.hadamard();
if (which_signal == 'A') {
    signal.phase(180, 1);
} else if (which_signal == 'A') {
    signal.phase(90, 1);
    signal.phase(180, 2);
} else if (which_signal == 'C') {
    signal.phase(45, 1);
    signal.phase(90, 2);
    signal.phase(180, 4);
}
qc.codeLabel();
qc.nop();

qc.codeLabel('QFT');
signal.invQFT();
qc.codeLabel();
qc.nop();

</textarea>

<script>
sample_list.push({ menu_name: 'Ex 7-2: QFT Spiral phase', id: 'qft_spiral_phase', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qft_spiral_phase_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qft_spiral_phase

var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')

// prepare the signal
signal.write(0);
signal.hadamard();
signal.phase(45, 1);
signal.phase(90, 2);
signal.phase(180, 4);

// Run the QFT
signal.QFT()
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 7-3: QFT wave period', id: 'qft_sample_code_1', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qft_sample_code_1_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qft_sample_code_1

var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')
var wave_period = 2; // A:1 B:2 C:4 D:8

// prepare the signal
signal.write(0);
signal.hadamard();
signal.phase(180, wave_period);

signal.QFT()
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 7-4: QFT Frequency to state', id: 'qft_freq_to_state', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qft_freq_to_state_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qft_freq_to_state

// Setup
var num_qubits = 4;
qc.reset(num_qubits);
var qin = qint.new(num_qubits, 'qin');

// Write the frequency we want to register
qin.write(3);

// Inverse QFT to turn into a signal
qin.invQFT()
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 7-5: QFT multipe frequencies', id: 'qft_example_10', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qft_example_10_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qft_example_10

// Setup
var num_qubits = 4;
qc.reset(num_qubits);
var qin = qint.new(num_qubits, 'qin');
qin.write(0);

// Write the frequencies we want to register
qin.had(1);
qc.cnot(14,1);
qin.not(2);
qc.cnot(1,2);
qin.not(2);

//Inverse QFT to turn into a signal
qin.invQFT()
</textarea>



<!--      CH08 phase estimation       -->
<!--      CH08 phase estimation       -->
<!--      CH08 phase estimation       -->
<!--      CH08 phase estimation       -->

<script>
sample_list.push({ menu_name: 'Ex 8-1: Phase estimation', id: 'phase1', num_qubits: 4, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="phase1_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=phase1
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 8-2: Phase estimation 2', id: 'phase2', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="phase2_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=phase2

//Specify the size of output register - determines precision of our answer
var m = 4;
// Specify the size of input register that will speicfy our eigenstate
var n = 1;
// Setup
qc.reset(m + n);
var qout = qint.new(m, 'output');
var qin = qint.new(n, 'input');
// Initialize output register all zeros
qout.write(0);
// Initialize input register as eigenstate of HAD
qin.write(0);
qin.rotx(22.5);
qin.phase(180);

// Define our conditional unitary
function cont_u(qcontrol, qtarget, control_count) {
    // For Hadamard, we ony need to know if control_count is even or odd,
    // as applying HAD an even number of times does nothing.
    if (control_count & 1)
        qtarget.chadamard(null, ~0, qcontrol.bits(control_count));
}


function phase_est(q_in, q_out, cont_u)
{
    // Main phase estimation single run
    // HAD the output register
    q_out.had();

    // Apply conditional powers of u
    for (j = 0; j < q_out.numBits; j++)
        cont_u(q_out, q_in, 1 << j);

    // Inverse QFT on output register
    q_out.invQFT();
}

// Operate phase estimation primitive on registers
phase_est(qin, qout, cont_u);
// Read output register
qout.read()
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 8-3: Phase estimation 3', id: 'phase3', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="phase3_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=phase3

function phase_est(q_in, q_out, cont_u)
{
    // Main phase estimation single run
    // HAD the output register
    q_out.had();

    // Apply conditional powers of u
    for (j = 0; j < q_out.numBits; j++)
        cont_u(q_out, q_in, 1 << j);

    // Inverse QFT on output register
    q_out.invQFT();
}
</textarea>



<!--      CH09 linear equations       -->
<!--      CH09 linear equations       -->
<!--      CH09 linear equations       -->
<!--      CH09 linear equations       -->

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>



<!--      CH10 smell of an app       -->
<!--      CH10 smell of an app       -->
<!--      CH10 smell of an app       -->
<!--      CH10 smell of an app       -->





<!--      CH11 real data       -->
<!--      CH11 real data       -->
<!--      CH11 real data       -->
<!--      CH11 real data       -->

<script>
sample_list.push({ menu_name: 'Ex 11-1: QRAM', id: 'ex_qram1', num_qubits: 3, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_qram1_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_qram1

var a = [4, 3, 5, 1];

qc.reset(3);
var qreg = qint.new(3, 'qreg');

function increment(index)
{
    qreg.write(a[index]);
    qreg.add(1);
    a[index] = qreg.read();
}

qc.print(a);
increment(2);
qc.print(a);
</textarea>



<!--      CH12 database search       -->
<!--      CH12 database search       -->
<!--      CH12 database search       -->
<!--      CH12 database search       -->

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>



<!--      CH13 supersampling       -->
<!--      CH13 supersampling       -->
<!--      CH13 supersampling       -->
<!--      CH13 supersampling       -->

<script>
sample_list.push({ menu_name: 'Ex 13-1: Basic phase graphics 1', id: 'ex_qss1a', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_qss1a_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_qss1a

qc.reset(8);
qx = qint.new(4, 'qx');
qy = qint.new(4, 'qy');

// Clear the canvas
qc.write(0);
qx.hadamard();
qy.hadamard();

// Invert if qx >= 8
qc.phase(180, qx.bits(0x8));

// 50% gray in the corner
qx.cnot(qy, 0x1);
qc.phase(180, qy.bits(0x8, qx.bits(0x8|0x1)));
qx.cnot(qy, 0x1);
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 13-2: Basic phase graphics 2', id: 'ex_qss2', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="ex_qss2_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=ex_qss2

qc.reset(8);
qx = qint.new(4, 'qx');
qy = qint.new(4, 'qy');

// Horizontal Line at qy=3
qy.not(~3);
qc.phase(180, qy.bits());
qy.not(~3);

// Vertical Line at qx=10
qx.not(~10);
qc.phase(180, qx.bits());
qx.not(~10);

// Diagonal Line at qy=-(qx+1)
qx.add(qy);
qc.phase(180, qx.bits());
qx.subtract(qy);
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 13-3: Basic phase graphics 3', id: 'qss3', num_qubits: 16, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qss3_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qss3

qc.reset(16);
qx = qint.new(4, 'qx');
qy = qint.new(4, 'qy');
qacc = qint.new(8, 'qacc');

var tx = 2;
var ty = 3;

// Hz Line y=3
qacc.cnot(qy)
qacc.add(ty * 4);
qacc.not(~3);
qc.phase(180, qacc.bits());
qacc.not(~3);
qacc.subtract(ty * 4);
qacc.cnot(qy);

// Vt Line x=10
qacc.cnot(qx)
qacc.add(tx * 4);
qacc.not(~10);
qc.phase(180, qacc.bits());
qacc.not(~10);
qacc.subtract(tx * 4);
qacc.cnot(qx);
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 13-4: Supersampling 4', id: 'qss4', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qss4_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qss4
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 13-5: Supersampling 5', id: 'qss5', num_qubits: 8, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="qss5_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=qss5
</textarea>



<!--      CH14 machine learning       -->
<!--      CH14 machine learning       -->
<!--      CH14 machine learning       -->
<!--      CH14 machine learning       -->

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>

<textarea id="xxxxx" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx
</textarea>



<!--      CH15 shor       -->
<!--      CH15 shor       -->
<!--      CH15 shor       -->
<!--      CH15 shor       -->


<script>
sample_list.push({ menu_name: 'Ex 15-1: Shor\'s Factroring Algorithm', id: 'shor_EX1', num_qubits: 12, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="shor_EX1_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=shor_EX1

function shor_sample() {
    N = 35;             // The number we're factoring
    precision_bits = 4; // See the text for a description
    coprime = 2;        // must be 2 in this QPU implementation

    result = Shor(N, precision_bits, coprime);
}

function Shor(N, precision_bits, coprime) {
    repeat_period = ShorQPU(N, precision_bits, coprime); // quantum part
    factors = ShorLogic(N, repeat_period, coprime);      // classical part
    return factors;
}

function ShorLogic(N, repeat_period, coprime) {
    // Given the repeat period, find the actual factors
    ar2 = Math.pow(coprime, repeat_period / 2.0);
    factor1 = gcd(N, ar2 - 1);
    factor2 = gcd(N, ar2 + 1);
    return [factor1, factor2];
}
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 15-2: Shor without a QPU', id: 'shor_shor2', num_qubits: 12, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="shor_shor2_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=shor_shor2

function ShorNoQPU(N, precision_bits, coprime) {
    // Classical replacement for the quantum part of Shor
    work = 1;
    max_loops = Math.pow(2, precision_bits);
    for (iter = 0; iter < max_loops; ++iter) {
        work = (work * coprime) % N;
        if (work == 1) // found the repeat
            return iter + 1;
    }
    return 0;
}
</textarea>

<script>
sample_list.push({ menu_name: 'Ex 15-3: Shor classical followup', id: 'shor_estimate_spike_number', num_qubits: 12, num_instructions: 6, num_circle_cols: 8, num_circle_rows: 1, circle_scale: 1.0, gate_scale: 1.0});
</script>
<textarea id="shor_estimate_spike_number_javascript" style="display:none;">
// Run this sample online: http://oreilly.machinelevel.com?p=xxxxx

function estimate_num_spikes(spike, range)
{
    if (spike < range / 2)
        spike = range - spike;
    best_error = 1.0;
    e0 = 0, e1 = 0, e2 = 0;
    actual = spike / range;
    candidates = []
    for (denom = 1.0; denom < spike; ++denom)
    {
        numerator = Math.round(denom * actual);
        estimated = numerator / denom;
        error = Math.abs(estimated - actual);
        e0 = e1;
        e1 = e2;
        e2 = error;
        // Look for a local minimum which beats our current best error
        if (e1 <= best_error && e1 < e0 && e1 < e2)
        {
            repeat_period = denom - 1;
            candidates.push(denom - 1);
            best_error = e1;
        }
    }
    return candidates;
}
</textarea>






































<textarea id="logic1_javascript_javascript" style="display:none;">
qc_options.color_by_phase = 1;
qc_options.book_render = 1;
qc.reset(3);
var a = qint.new(1, 'a')
var b = qint.new(1, 'b')
var c = qint.new(1, 'c')

qc.codeLabel('c = ~c');
c.write(0);
qc.nop();
c.not();
qc.nop();
c.read();
qc.codeLabel('');
qc.nop();

qc.codeLabel('if (b) then c = ~c');
qc.write(2, 2|4);
qc.nop();
c.cnot(b);
qc.nop();
qc.read(2|4);
qc.codeLabel('');
qc.nop();

qc.codeLabel('if (a and b) then c = ~c');
qc.write(1|2);
qc.nop();
qc.cnot(4, 1|2);
qc.nop();
qc.read(1|2|4);
qc.codeLabel('');
qc.nop();
</textarea>

<textarea id="logic2_javascript_javascript" style="display:none;">
// Initialize
num_qubits = 4;
qc_options.color_by_phase = true;
qc.reset(num_qubits);
a = qint.new(num_qubits, 'a');

// prepare
qc.codeLabel('prepare');
a.write(1);
a.hadamard(0x4);
a.phase(45, 0x4);
qc.codeLabel('');

qc.nop();
qc.nop();

// increment
qc.codeLabel('increment');
a.add(1);
qc.codeLabel('');

qc.nop();
qc.nop();

// increment
qc.codeLabel('decrement');
a.subtract(1);
qc.codeLabel('');

qc.nop();
</textarea>

<textarea id="logic2_python_javascript" style="display:none;">

### Python version coming soon!

</textarea>

<textarea id="grover1_javascript" style="display:none;">
var number_to_flip = 3;

qc_options.color_by_phase = 1;
qc_options.book_render = 1;
var num_qubits = 4;
qc.reset(num_qubits);
var reg = qint.new(num_qubits, 'reg')

reg.write(0);
qc.codeLabel('prep');
reg.hadamard();
qc.codeLabel('');
qc.nop();

// Flip the marked value
qc.codeLabel('flip');
reg.not(~number_to_flip);
reg.phase(180);
reg.not(~number_to_flip);
qc.codeLabel('');

qc.codeLabel('Grover');
reg.Grover();
qc.codeLabel('');
qc.nop();
</textarea>

<textarea id="grover2_javascript" style="display:none;">
var number_to_flip = 3;
var number_of_iterations = 4;

qc_options.color_by_phase = 1;
qc_options.book_render = 1;
var num_qubits = 4;
qc.reset(num_qubits);
var reg = qint.new(num_qubits, 'reg')

reg.write(0);
qc.codeLabel('prep');
reg.hadamard();
qc.codeLabel('');
qc.nop();

for (var i = 0; i < number_of_iterations; ++i)
{
    prob = reg.peekProbability(number_to_flip);
    qc.print('prob before: ' + prob + '\n');

    // Flip the marked value
    qc.codeLabel('flip ' + (i + 1));
    reg.not(~number_to_flip);
    reg.phase(180);
    reg.not(~number_to_flip);
    qc.codeLabel('');

    qc.codeLabel('Grover ' + (i + 1));
    reg.Grover();
    qc.codeLabel('');
    qc.nop();
    
    prob = reg.peekProbability(number_to_flip);
    qc.print('prob after: ' + prob + '\n');
    prob = reg.peekProbability(0);
    qc.print('alt prob after: ' + prob + '\n');
}
</textarea>

<textarea id="qft1_javascript" style="display:none;">
qc_options.color_by_phase = 1;
qc_options.book_render = 1;
var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')

// prepare the signal A
signal.write(0);
signal.hadamard();
signal.phase(180, 1);

// prepare the signal B
signal.write(0);
signal.hadamard();
signal.phase(90, 1);
signal.phase(180, 2);

// prepare the signal C
signal.write(0);
signal.hadamard();
signal.phase(45, 1);
signal.phase(90, 2);
signal.phase(180, 4);
</textarea>

<textarea id="qft2_javascript" style="display:none;">
var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')

// prepare the signal
signal.write(0);
signal.hadamard();
signal.phase(45, 1);
signal.phase(90, 2);
signal.phase(180, 4);

// Run the QFT
signal.QFT()
</textarea>

<textarea id="qft3_javascript" style="display:none;">
var num_qubits = 4;
qc.reset(num_qubits);
var signal = qint.new(num_qubits, 'signal')
var wave_period = 2; // A:1 B:2 C:4 D:8

// prepare the signal
signal.write(0);
signal.hadamard();
signal.phase(180, wave_period);

signal.QFT()
</textarea>

<textarea id="qft10_javascript" style="display:none;">
// Setup
var num_qubits = 4;
qc.reset(num_qubits);
var qin = qint.new(num_qubits, 'qin');

// Write the frequency we want to register
qin.write(3);

// Inverse QFT to turn into a signal
qin.invQFT()
</textarea>

<textarea id="qft11_javascript" style="display:none;">
// Setup
var num_qubits = 4;
qc.reset(num_qubits);
var qin = qint.new(num_qubits, 'qin');
qin.write(0);

// Write the frequencies we want to register
qin.had(1);
qc.cnot(14,1);
qin.not(2);
qc.cnot(1,2);
qin.not(2);

//Inverse QFT to turn into a signal
qin.invQFT()
</textarea>

<textarea id="shor1_javascript" style="display:none;">
function shor_sample() {
    N = 35;             // The number we're factoring
    precision_bits = 4; // See the text for a description of this
    coprime = 2;        // For this QPU implementation, this must be 2

    result = Shor(N, precision_bits, coprime);
}

function Shor(N, precision_bits, coprime) {
    repeat_period = ShorQPU(N, precision_bits, coprime);  // the quantum part
    factors = ShorLogic(N, repeat_period, coprime);       // the classical part
    return factors;
}

function ShorLogic(N, repeat_period, coprime) {
    // Given the repeat period, find the actual factors
    ar2 = Math.pow(coprime, repeat_period / 2.0);
    factor1 = gcd(N, ar2 - 1);
    factor2 = gcd(N, ar2 + 1);
    return [factor1, factor2];
}
</textarea>

<textarea id="shor2_javascript" style="display:none;">
function ShorQPU_placeholder(N, precision_bits, coprime) {
    // Classical replacement for the quantum part of Shor
    work = 1;
    max_loops = Math.pow(2, precision_bits);
    for (iter = 0; iter < max_loops; ++iter) {
        work = (work * coprime) % N;
        if (work == 1) // found the repeat
            return iter + 1;
    }
    return 0;
}
</textarea>

<textarea id="shor7_javascript" style="display:none;">
function estimate_num_spikes(spike, range)
{
    if (spike < range / 2)
        spike = range - spike;
    best_error = 1.0;
    e0 = 0, e1 = 0, e2 = 0;
    actual = spike / range;
    candidates = []
    for (denom = 1.0; denom < spike; ++denom)
    {
        numerator = Math.round(denom * actual);
        estimated = numerator / denom;
        error = Math.abs(estimated - actual);
        e0 = e1;
        e1 = e2;
        e2 = error;
        // Look for a local minimum which beats our current best error
        if (e1 <= best_error && e1 < e0 && e1 < e2)
        {
            repeat_period = denom - 1;
            candidates.push(denom - 1);
            best_error = e1;
        }
    }
    return candidates;
}
</textarea>






<textarea id="phase1_javascript" style="display:none;">
qc.reset(1);

var reg = qint.new(1, 'reg');

reg.write(0);
reg.rotx(22.5);
reg.had();
reg.had();

reg.write(0);
reg.rotx(22.5);
reg.phase(180);
reg.had();
reg.had();
</textarea>

<textarea id="phase2_javascript" style="display:none;">
// Run this sample at http://oreilly.machinelevel.com?p=phase2
qc_options.color_by_phase = true;

function main()
{
    //Specify the size of output register - determines precision of our answer
    var m = 4;
    // Specify the size of input register that will speicfy our eigenstate
    var n = 1;
    // Setup
    qc.reset(m + n);
    var qout = qint.new(m, 'output');
    var qin = qint.new(n, 'input');
    // Initialize output register all zeros
    qout.write(0);
    // Initialize input register as eigenstate of HAD
    qin.write(0);
    var eigenstate_to_test = 'a'; // a or b, from the book
    if (eigenstate_to_test == 'a') {
        qin.rotx(22.5);
    }
    else {
        qin.rotx(22.5);
        qin.phase(180);
    }
    // Define our conditional unitary
    function cont_u(qcontrol, qtarget, control_count) {
        // For Hadamard, we ony need to know if control_count is even or odd,
        // as applying HAD an even number of times does nothing.
        if (control_count & 1)
            qtarget.chadamard(null, ~0, qcontrol.bits(control_count));
    }
    // Operate phase estimation primitive on registers
    phase_est(qin, qout, cont_u);
    // Read output register
    qout.read()
}


var qft_flip = function(N, flipqint) {
    for (i=0; i<=Math.floor(N/2)-1; i++) {
        var val = (1 << i) | (1 << (N-i-1));
        qc.exchange(val);
    }
}

function phase_est(q_in, q_out, cont_u)
{
    // Main phase estimation single run
    // HAD the output register
    q_out.had();
    var out_res = q_out.numBits;

    // Apply conditional powers of u
    for (j = 0; j < out_res; j++)
        cont_u(q_out, q_in, 1 << j);

    // Inverse QFT on output register
    // (Note qft backwards and doesn't include 
    // exchanges in QCEngine at the moment)
    qft_flip(out_res);
    q_out.QFT();
}


main();
</textarea>






































































<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_bitfield.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_reg.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_int.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_basicops.js"></script>


<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_widgets.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_blockjob.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_staff.js"></script>

<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_setup.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_scriptpanel.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_panel.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_photonic.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_test.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_webgl_block.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_mbc.js"></script>
<script type="text/javascript" src="http://machinelevel.com/qc/qcengine_aaronson_chp.js"></script>


</body>
</html>
